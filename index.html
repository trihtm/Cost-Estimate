<!DOCTYPE html>
<html lang="en" ng-app="costEstimateApp">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Project Cost Estimate</title>

        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-7s5uDGW3AHqw6xtJmNNtr+OBRJUlgkNJEo78P4b0yRw= sha512-nNo+yCHEyn0smMxSswnf/OnX6/KwJuZTlNZBjauKhTK0c+zT+q5JOCx0UFhXQ6rJR9jg6Es8gPuD2uZcYDLqSw==" crossorigin="anonymous">

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>

    <body ng-controller="costEstimateController as costEstimate">
        <div class="container">
            <div class="page-header">
                <h1>Cost Estimate</h1>
            </div>

            <div class="row">
                <div class="col-lg-4">
                    <h3>Product Summary</h3>

                    <hr />

                    <dl class="dl-horizontal">
                        <dt>Subtotal</dt>
                        <dd>${{ costEstimate.getSubPrice() }}</dd>

                        <dt>VAT({{ TAX }}%)</dt>
                        <dd>${{ costEstimate.getVAT() }}</dd>

                        <dt>Total</dt>
                        <dd>${{ costEstimate.getTotalPrice() }}</dd>
                    </dl>

                    <hr />

                    <div class="control text-right">
                        <button type="button" class="btn btn-reserve" ng-class="{'btn-primary': costEstimate.getStep() == 5}">Buy now</button>
                    </div>
                </div>

                <div class="col-lg-8">
                    <div class="progress">
                        <div class="progress-bar" role="progressbar"
                             aria-valuenow="{{ costEstimate.getProgress() }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ costEstimate.getProgress() }}%;">
                            <span class="sr-only">{{ costEstimate.getProgress() }}% Complete</span>
                        </div>
                    </div>

                    <h3>Step 1. Choose a product group</h3>

                    <hr />

                    <div class="row">
                        <div class="col-lg-3 text-center" ng-repeat="(key, productGroup) in costEstimate.config">
                            <button type="button" class="btn btn-default" ng-click="costEstimate.setProductGroup(key)" ng-class="{'btn-primary': costEstimate.getProductGroup() == key}">
                                {{ productGroup.name }}
                            </button>
                        </div>
                    </div>

                    <div ng-if="costEstimate.getStep() >= 2">
                        <h3>Step 2. Choose a product type</h3>

                        <hr />

                        <div ng-repeat="(productGroupSlug, productGroup) in costEstimate.config">
                            <div class="row" ng-if="costEstimate.getProductGroup() == productGroupSlug">
                                <div class="col-lg-4 text-center"
                                     ng-repeat="(productTypeSlug, productType) in costEstimate.config[productGroupSlug]['types']">
                                    <button type="button" class="btn btn-default"
                                            ng-click="costEstimate.setProductType(productTypeSlug)"
                                            ng-class="{'btn-primary': costEstimate.isProductTypeChoosen(productTypeSlug)}">
                                        {{ productType.name }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div ng-if="costEstimate.getStep() >= 3">
                        <h3>Step 3. Choose a product scale</h3>

                        <hr />

                        <div ng-repeat="(productGroupSlug, productGroup) in costEstimate.config">
                            <div class="row" ng-if="costEstimate.getProductGroup() == productGroupSlug">
                                <div class="col-lg-3 text-center"
                                     ng-repeat="(productScaleSlug, productScale) in costEstimate.config[productGroupSlug]['scales']">
                                    <button type="button" class="btn btn-default"
                                            ng-click="costEstimate.setProductScale(productScaleSlug)"
                                            ng-class="{'btn-primary': costEstimate.getProductScale() == productScaleSlug}">
                                        {{ productScale.name }} ({{ productScale.pages }} pages)
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div ng-if="costEstimate.getStep() >= 4">
                        <h3>Step 4. Choose additional features</h3>

                        <hr />

                        <div ng-repeat="(productGroupSlug, productGroup) in costEstimate.config">
                            <div ng-if="costEstimate.getProductGroup() == productGroupSlug">
                                <table class="table table-bordered">
                                    <tr>
                                        <th>Feature name</th>

                                        <th>Price</th>

                                        <th>Action</th>
                                    </tr>
                                    <tr ng-repeat="(featureSlug, feature) in costEstimate.config[productGroupSlug]['additional-features']">
                                        <td>
                                            {{ feature.name }}
                                        </td>

                                        <td>
                                            $
                                        </td>

                                        <td class="text-center">
                                            <button type="button" class="btn btn-default"
                                                    ng-click="costEstimate.setFeature(featureSlug)"
                                                    ng-class="{'btn-primary': costEstimate.isFeatureChoosen(featureSlug)}">
                                                Choose
                                            </button>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div ng-if="costEstimate.getStep() >= 4">
                        <h3>Last step. Choose quality multiplier</h3>

                        <hr />

                        <div ng-repeat="(productGroupSlug, productGroup) in costEstimate.config">
                            <div class="row" ng-if="costEstimate.getProductGroup() == productGroupSlug">
                                <div class="col-lg-4 text-center"
                                     ng-repeat="(qualitySlug, quality) in costEstimate.config[productGroupSlug]['quality']">
                                    <button type="button" class="btn btn-default"
                                            ng-click="costEstimate.setQuality(qualitySlug)"
                                            ng-class="{'btn-primary': costEstimate.getQuality() == qualitySlug}">
                                        {{ quality.name }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <br />
                </div>
            </div>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js" type="text/javascript"></script>

        <script type="text/javascript">
            var costEstimateConfig = {
                'desktop-app': {
                    'name': 'Desktop App',

                    'types': {
                        'windows': {
                            'name': 'Windows'
                        },

                        'mac': {
                            'name': 'Mac'
                        },

                        'linux': {
                            'name': 'Linux'
                        }
                    },

                    'scales': {
                        'simple': {
                            'pages': 10,
                            'name': 'Simple',
                            'mandays': 15
                        },

                        'moderate': {
                            'pages': 20,
                            'name': 'Moderate',
                            'mandays': 25
                        },

                        'large': {
                            'pages': 30,
                            'name': 'Large',
                            'mandays': 40
                        }
                    },

                    'additional-features': {
                        'design': {
                            'name': 'Design'
                        },

                        'admin-system': {
                            'name': 'Admin System (10 views)'
                        },

                        'sns-login': {
                            'name': 'SNS Login ( Facebook / Twitter / Google+ / Instagram )',
                            'extraForm': true
                        },

                        'newsletter': {
                            'name': 'NewsLetter Sending System'
                        },

                        'notification': {
                            'name': 'Push Notification Sending System'
                        },

                        'online-payment': {
                            'name': 'Online Payment'
                        },

                        'other-service-integration': {
                            'name': 'Other Service Integration ( API Provided Services )',
                            'extraForm': true
                        },

                        'data-analytics': {
                            'name': 'Data Analytics ( Basic )'
                        }
                    },

                    'quality': {
                        'prototype': {
                            'name': 'Prototype Quality',
                            'multiplier': 1
                        },

                        'release': {
                            'name': 'Release Quality',
                            'multiplier': 1.3
                        }
                    }
                },

                'mobile-app': {
                    'name': 'Mobile App',

                    'types': {
                        'ios-mobile': {
                            'name': 'iPhone'
                        },

                        'ios-tablet': {
                            'name': 'iPad'
                        },

                        'ios-watch': {
                            'name': 'iWatch'
                        },

                        'android-mobile': {
                            'name': 'Android Mobile'
                        },

                        'android-tablet': {
                            'name': 'Android Tablet'
                        },

                        'android-watch': {
                            'name': 'Android Watch'
                        },

                        'wp-mobile': {
                            'name': 'WindowsPhone Mobile'
                        },

                        'wp-tablet': {
                            'name': 'WindowsPhone Tablet'
                        },

                        'wp-watch': {
                            'name': 'WindowsPhone Watch'
                        }
                    },

                    'scales': {
                        'simple': {
                            'pages': 10,
                            'name': 'Simple',
                            'mandays': 15
                        },

                        'moderate': {
                            'pages': 20,
                            'name': 'Moderate',
                            'mandays': 25
                        },

                        'large': {
                            'pages': 30,
                            'name': 'Large',
                            'mandays': 40
                        }
                    },

                    'additional-features': {
                        'design': {
                            'name': 'Design'
                        },

                        'admin-system': {
                            'name': 'Admin System (10 views)'
                        },

                        'sns-login': {
                            'name': 'SNS Login ( Facebook / Twitter / Google+ / Instagram )',
                            'extraForm': true
                        },

                        'newsletter': {
                            'name': 'NewsLetter Sending System'
                        },

                        'notification': {
                            'name': 'Push Notification Sending System'
                        },

                        'online-payment': {
                            'name': 'Online Payment'
                        },

                        'other-service-integration': {
                            'name': 'Other Service Integration ( API Provided Services )',
                            'extraForm': true
                        },

                        'data-analytics': {
                            'name': 'Data Analytics ( Basic )'
                        }
                    },

                    'quality': {
                        'prototype': {
                            'name': 'Prototype Quality',
                            'multiplier': 1
                        },

                        'release': {
                            'name': 'Release Quality',
                            'multiplier': 1.3
                        }
                    }
                },

                'static-website': {
                    'name': 'Static Website',
                    'types': {
                        'pc': {
                            'name': 'PC Site'
                        },

                        'mobile': {
                            'name': 'Mobile Site'
                        },

                        'responsive': {
                            'name': 'Responsive Site Support Both'
                        }
                    },

                    'scales': {
                        'simple': {
                            'pages': 5,
                            'name': 'Simple',
                            'mandays': 5
                        },

                        'moderate': {
                            'pages': 10,
                            'name': 'Moderate',
                            'mandays': 8
                        },

                        'large': {
                            'pages': 20,
                            'name': 'Large',
                            'mandays': 10
                        }
                    },

                    'additional-features': {
                        'design': {
                            'name': 'Design'
                        },

                        'contact-form': {
                            'name': 'Contact Form'
                        },

                        'cms-original': {
                            'name': 'CMS ( Original )'
                        },

                        'cms-wordpress': {
                            'name': 'CMS ( Word Press )'
                        }
                    },

                    'quality': {
                        'prototype': {
                            'name': 'Prototype Quality',
                            'multiplier': 1
                        },

                        'release': {
                            'name': 'Release Quality',
                            'multiplier': 1.3
                        }
                    }
                },

                'web-app': {
                    'name': 'Web App',

                    'types': {
                        'pc': {
                            'name': 'PC Site'
                        },

                        'mobile': {
                            'name': 'Mobile Site'
                        },

                        'responsive': {
                            'name': 'Responsive Site Support Both'
                        }
                    },

                    'scales': {
                        'simple': {
                            'pages': 10,
                            'name': 'Simple',
                            'mandays': 15
                        },

                        'moderate': {
                            'pages': 20,
                            'name': 'Moderate',
                            'mandays': 25
                        },

                        'large': {
                            'pages': 30,
                            'name': 'Large',
                            'mandays': 40
                        }
                    },

                    'additional-features': {
                        'design': {
                            'name': 'Design'
                        },

                        'admin-system': {
                            'name': 'Admin System (10 views)'
                        },

                        'sns-login': {
                            'name': 'SNS Login ( Facebook / Twitter / Google+ / Instagram )',
                            'extraForm': true
                        },

                        'newsletter': {
                            'name': 'NewsLetter Sending System'
                        },

                        'notification': {
                            'name': 'Push Notification Sending System'
                        },

                        'online-payment': {
                            'name': 'Online Payment'
                        },

                        'other-service-integration': {
                            'name': 'Other Service Integration ( API Provided Services )',
                            'extraForm': true
                        },

                        'data-analytics': {
                            'name': 'Data Analytics ( Basic )'
                        }
                    },

                    'quality': {
                        'prototype': {
                            'name': 'Prototype Quality',
                            'multiplier': 1
                        },

                        'release': {
                            'name': 'Release Quality',
                            'multiplier': 1.3
                        }
                    }
                }
            };
        </script>

        <!--- Run angular js -->
        <script type="text/javascript">
            var costEstimateApp = angular.module('costEstimateApp', []);

            costEstimateApp.controller('costEstimateController', function ($scope) {
                var costEstimate = this;

                // CONSTANTS
                $scope.WORKING_HOURS_PER_DAY = 8; // hours
                $scope.PRICE_PER_HOUR = 25; // dollars
                $scope.TAX = 10; // Percent
                $scope.PM_QA_COST = 1.3;

                costEstimate.config = costEstimateConfig;

                /** STEP **/
                costEstimate.__step = 1;

                costEstimate.setStep = function () {
                    var step = 1;

                    if (costEstimate.getProductGroup() != null) {
                        step = 2;

                        if (costEstimate.__productTypes.hasOwnProperty([costEstimate.getProductGroup()]) &&
                            Object.keys(costEstimate.__productTypes[costEstimate.getProductGroup()]).length > 0) {
                            step = 3;

                            if (costEstimate.getProductScale() != null) {
                                step = 4;

                                if (costEstimate.getQuality() != null) {
                                    step = 5;
                                }
                            }
                        }
                    }

                    costEstimate.__step = step;
                    costEstimate.setProgress(step / 5 * 100);
                };

                costEstimate.getStep = function () {
                    return costEstimate.__step;
                };

                /** PRICE **/
                costEstimate.__subTotalPrice = 0;

                costEstimate.getSubPrice = function () {
                    return costEstimate.__subTotalPrice;
                };

                costEstimate.getVAT = function () {
                    return costEstimate.getSubPrice() * $scope.TAX / 100;
                };

                costEstimate.getTotalPrice = function () {
                    return costEstimate.getSubPrice() + costEstimate.getVAT();
                };

                costEstimate.setSubPrice = function () {
                    var basePrice = 0.00;
                    var subPrice = 0.00;

                    var productGroup = costEstimate.getProductGroup();
                    var productScale = costEstimate.getProductScale();

                    // PRODUCT GROUP & SCALE
                    if (costEstimate.getStep() >= 4) {
                        basePrice = costEstimate.config[productGroup]['scales'][productScale]['mandays'];
                    }

                    // PRODUCT TYPES
                    if (costEstimate.getStep() >= 4) {
                        var productTypes = costEstimate.__productTypes[productGroup];

                        for (var productTypeSlug in productTypes) {
                            var status = productTypes[productTypeSlug];

                            if (status) {

                            }
                        }
                    }

                    // ADDITIONAL FEATURES
                    if (costEstimate.getStep() >= 4) {

                    }

                    subPrice = basePrice;

                    // QUALITY
                    if (costEstimate.getStep() >= 5) {

                        var quality = costEstimate.getQuality();
                        subPrice *= costEstimate.config[productGroup]['quality'][quality]['multiplier'];
                    }

                    // Final total price.
                    costEstimate.__subTotalPrice = subPrice * $scope.WORKING_HOURS_PER_DAY * $scope.PRICE_PER_HOUR * $scope.PM_QA_COST;
                };

                /** PROGRESS **/
                costEstimate.__progress = 0;

                costEstimate.setProgress = function (progress) {
                    costEstimate.__progress = progress;
                };

                costEstimate.getProgress = function () {
                    return costEstimate.__progress;
                };

                /** PRODUCT GROUP **/
                costEstimate.__productGroup = null;

                costEstimate.setProductGroup = function (productGroup) {
                    // Set product group
                    costEstimate.__productGroup = productGroup;

                    costEstimate.setStep();
                    costEstimate.setSubPrice();
                };

                costEstimate.getProductGroup = function () {
                    return costEstimate.__productGroup;
                };

                /** PRODUCT TYPE **/
                costEstimate.__productTypes = {};

                costEstimate.setProductType = function (productType) {
                    if (costEstimate.isProductTypeChoosen(productType)) {
                        delete costEstimate.__productTypes[costEstimate.getProductGroup()][productType];
                    } else {
                        if (!costEstimate.__productTypes.hasOwnProperty([costEstimate.getProductGroup()])) {
                            costEstimate.__productTypes[costEstimate.getProductGroup()] = {};
                        }

                        costEstimate.__productTypes[costEstimate.getProductGroup()][productType] = true;
                    }

                    costEstimate.setStep();
                    costEstimate.setSubPrice();
                };

                costEstimate.isProductTypeChoosen = function (productType) {
                    if (costEstimate.__productTypes.hasOwnProperty([costEstimate.getProductGroup()]) &&
                        costEstimate.__productTypes[costEstimate.getProductGroup()].hasOwnProperty(productType)) {
                        return costEstimate.__productTypes[costEstimate.getProductGroup()][productType];
                    }

                    return false;
                };

                /** PRODUCT SCALE **/
                costEstimate.__productScale = null;

                costEstimate.setProductScale = function (productScale) {
                    // Set product scale
                    costEstimate.__productScale = productScale;

                    costEstimate.setStep();
                    costEstimate.setSubPrice();
                };

                costEstimate.getProductScale = function () {
                    return costEstimate.__productScale;
                };

                /** ADDITIONAL FEATURES **/
                costEstimate.__additionalFeatures = {};

                costEstimate.setFeature = function (feature) {
                    if (costEstimate.isFeatureChoosen(feature)) {
                        delete costEstimate.__additionalFeatures[costEstimate.getProductGroup()][feature];
                    } else {
                        if (!costEstimate.__additionalFeatures.hasOwnProperty([costEstimate.getProductGroup()])) {
                            costEstimate.__additionalFeatures[costEstimate.getProductGroup()] = {};
                        }

                        costEstimate.__additionalFeatures[costEstimate.getProductGroup()][feature] = true;
                    }

                    costEstimate.setStep();
                    costEstimate.setSubPrice();
                };

                costEstimate.isFeatureChoosen = function (feature) {
                    if (costEstimate.__additionalFeatures.hasOwnProperty([costEstimate.getProductGroup()]) &&
                            costEstimate.__additionalFeatures[costEstimate.getProductGroup()].hasOwnProperty(feature)) {
                        return costEstimate.__additionalFeatures[costEstimate.getProductGroup()][feature];
                    }

                    return false;
                };

                /** SET quality **/
                costEstimate.__quality = null;

                costEstimate.setQuality = function (quality) {
                    costEstimate.__quality = quality;

                    costEstimate.setStep();
                    costEstimate.setSubPrice();
                };

                costEstimate.getQuality = function () {
                    return costEstimate.__quality;
                };
            });

            function numberWithCommas(x) {
                return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
        </script>
    </body>
</html>